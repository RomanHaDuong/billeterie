<VirtualHost *:80>
    ServerName les-ecoworkers.fr
    ServerAlias www.les-ecoworkers.fr
    
    DocumentRoot /home/pi/apps/billeterie/current/public
    
    # Redirect HTTP to HTTPS
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</VirtualHost>

<VirtualHost *:443>
    ServerName les-ecoworkers.fr
    ServerAlias www.les-ecoworkers.fr
    
    DocumentRoot /home/pi/apps/billeterie/current/public
    
    # SSL Configuration (you'll need to set up certificates)
    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/ssl-cert-snakeoil.pem
    SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key
    # For Let's Encrypt certificates, use:
    # SSLCertificateFile /etc/letsencrypt/live/les-ecoworkers.fr/fullchain.pem
    # SSLCertificateKeyFile /etc/letsencrypt/live/les-ecoworkers.fr/privkey.pem
    
    <Directory /home/pi/apps/billeterie/current/public>
        AllowOverride all
        Options -MultiViews
        Require all granted
    </Directory>
    
    # Proxy configuration for Puma
    ProxyPreserveHost On
    ProxyPass / unix:/home/pi/apps/billeterie/shared/tmp/sockets/puma.sock|http://localhost/
    ProxyPassReverse / unix:/home/pi/apps/billeterie/shared/tmp/sockets/puma.sock|http://localhost/
    
    # Error and Access logs
    ErrorLog ${APACHE_LOG_DIR}/billeterie_error.log
    CustomLog ${APACHE_LOG_DIR}/billeterie_access.log combined
    
    # Allow encoded slashes
    AllowEncodedSlashes NoDecode
</VirtualHost>
